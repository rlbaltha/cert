{% extends '::base.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script language="javascript">
        $(document).ready(function () {
            $.tablesorter.themes.bootstrap = {
                table: 'table table-bordered table-striped',
                caption: 'caption',
                header: 'bootstrap-header',
                iconSortNone: 'bootstrap-icon-unsorted',
                iconSortAsc: 'glyphicon glyphicon-chevron-up',
                iconSortDesc: 'glyphicon glyphicon-chevron-down',
            };
            $("table").tablesorter({
                theme: "bootstrap",
                widthFixed: true,
                headerTemplate: '{content} {icon}',
                widgets: ["uitheme", "filter", "zebra"],
                widgetOptions: {
                    zebra: ["even", "odd"],
                    filter_reset: ".reset",
                    filter_cssFilter: "form-control",
                },
                headers: {}
            });
            $('.tag_filter').click(function (event) {
                var row_selector = 'div.tag' + event.target.id;
                $('.source_row').hide();
                $(row_selector).parent().parent().show();
            });
            $('.sub').hide();
            $('.super').click(function () {
                $('.sub').toggle();
            });
            $('#tag_showall').click(function () {
                $('.source_row').show();
            });
        });
    </script>
{% endblock %}

{% block body -%}

    <div class="col-sm-12">
        <h1 class="inline">Resources</h1>
        <a class="btn btn-secondary btn-lg" href="{{ path('source_new', { 'type': 'content' }) }}">New Resource</a>
        <p>Prototype of Resource Repository</p>
        <p class="alert alert-info">The tags below are clickable.</p>
        {% for tag in tags if tag.top|length == 0 %}
            <div id="{{ tag.id }}" class="btn btn-primary btn-lg tag_filter super"
                 style="background-color: {{ tag.color }}">{{ tag.title }}</div><br/>
            {% for tag in tag.subs %}
                <div id="{{ tag.id }}" class="btn btn-primary btn-md tag_filter sub"
                     style="background-color: {{ tag.color }}">{{ tag.title }}</div>
                {% for tag in tag.subs %}
                    <div id="{{ tag.id }}" class="btn btn-primary btn-sm tag_filter sub"
                         style="background-color: {{ tag.color }}">{{ tag.title }}</div>
                {% endfor %}
                <br/>
            {% endfor %}
        {% endfor %}

        <br/>
        <div id="tag_showall" class="btn btn-secondary btn-lg tag_filter">Show all</div>

        <table class="table">
            <thead>
            <tr>
                <th>Name</th>
                <th>URL/File</th>
                <th>Tags</th>
            </tr>
            </thead>
            <tbody>
            {% for entity in entities %}
                <tr class="source_row">
                    <td><a href="{{ path('source_show', { 'id': entity.id }) }}">{{ entity.name }}</a></td>
                    <td>
                        {% if 'http' in entity.contact %}
                            <a href="{{ entity.contact }}" target="_blank">{{ entity.contact }}</a>
                        {% else %}
                            {{ entity.contact }}
                        {% endif %}
                    </td>
                    <td>{% for tag in entity.tags %}
                            <div class="btn btn-primary btn-sm tag{{ tag.id }}"
                                 style="background-color: {{ tag.color }}">{{ tag.title }}</div>{% endfor %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    </div>

{% endblock %}
